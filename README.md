## Magical Piano V1.0
心情烦躁？无心工作与学习？不如来感受一下美妙的音乐世界！
## 如何运行项目
```
// 从仓库中克隆项目
git clone git@github.com:sdulkp/magical-piano.git
// 安装项目所需依赖
yarn || npm install
// 运行项目
yarn dev || npm run dev
```
## 演示地址
![Image text](https://github.com/sdulkp/magical-piano/blob/main/readme_imgs/piano-ui.png)
暂无
## 项目介绍
Magical Piano是一个Web钢琴应用，基于**Vue3 + Vite + Web Audio API + Koa**构建，可以使用PC端浏览器访问，也支持使用移动设备在横屏状态下访问。
在这个应用中，我自定义了一种名为mus的音乐文件格式，你可以将自己喜欢的音乐的五线谱或简谱翻译成这种格式，点击操作面板上的播放按钮就可以自动演奏啦！（当然这可能需要一些简单的乐理知识）:stuck_out_tongue_winking_eye:
<br /><br />
你也可以使用鼠标或键盘来演奏钢琴，不过由于键盘空间的限制，只有C3-B4两个八度的音符可以演奏。键盘中的`Q` `2` `W` `3` `E` `R` `5` `T` `6` `Y` `7` `U`对应音符中的`C3` `C#3` `D3` `D#3` `E3` `F3` `F#3` `G3` `G#3` `A3` `A#3` `B3`（小字组），`V` `B` `H` `N` `M` `K` `,` `L` `.` `;` `/`对应`C4` `C#4` `D4` `D#4` `E4` `F4` `F#4` `G4` `G#4` `A4` `A#4` `B4`（小字一组）。
### 什么是mus文件？
mus实际是上文本文件，结构如下：
```
// 第一行声明调性差值和拍数，中间用任意个空格隔开
[deltaTone] [beats]
// 后面的多行描述音轨，每个音轨起始行以###标记
// 每个音轨演奏的音符序列由音名和演奏节拍构成，音名使用升降写法均可，演奏节拍可以精确到三位小数
// 音轨描述中的每一行为一个小节，为了方便对照乐谱，可以在每一行首添加小节序号
###
(1)G4/1.0 A4/3.5...
```
实际上在midi文件中，钢琴曲一般只有一条音轨，在mus文件中借用音轨的概念，并将右手的旋律和左手的伴奏拆分成两条音轨，这样在设计程序逻辑时相对好处理一些。原因是midi文件会精确地描述某个音符在某个时间点应该演奏的时长，而mus文件则是与乐谱一一对应的，在自动演奏时按照文件定义的顺序进行，音符何时演奏以及演奏时长取决于文件中的节拍数以及上一组音符是否演奏完毕。mus文件中的音轨可以是一条或多条，如果是多条音轨，描述中可以以任意个空行相间隔。<br /><br />
mus文件中第一行的deltaTone为**调性差值**，所谓差值是与C大调相比较而言升了或降了多少个key。这里把C大调记为0，如果乐谱的调性是升F大调，deltaTone就应该是5，因为升F大调比C大调高了5个key；这个值当然也可以是负数，表明相比C大调降了多少个key。<br /><br />
![Image text](https://github.com/sdulkp/magical-piano/blob/main/readme_imgs/jiangnan.png)
以江南这首曲子的简谱为例，在简谱图片中可以看到，这首曲子的调性为C大调，节奏为4/4拍，即以四分音符为一拍，每小节4拍，简谱中还标明了每分钟由112拍构成。那么在mus文件中`deltaTone`就应该记为0，`beats`应该记为112。将乐谱的前四个小节翻译为音轨描述，结果如下：
```
0 112
###
(1)&/2 C5/0.5 G5/0.5 E5/0.5 C5/0.5
(2)A4/4
(3)&/1.0 G4/0.5 A4/0.5 B4/0.5 C5/0.5 &/1.0
(4)A4/4
###
(1)A3/0.5 E4/0.5 A4/0.5 B4/0.5 C5/0.5 &/1.5
(2)F3/0.5 C4/0.5 F4/0.5 G4/0.5 A4/1.0 E5/1.0
(3)G3/0.5 D4/0.5 &/2.5 C5/0.25 B4/0.25
(4)A3/0.5 E4/0.5 A4/0.5 B4/0.5 C5/0.5 E5/0.5|G5/0.5 D5/0.5|F#5/0.5 C5/0.5|E5/0.5
```
音轨的定义顺序是随意的，可以是伴奏在前，也可以是旋律在前。在音轨描述中，简化了五线谱和简谱中的各种符号，例如延音记号和附点音符等，只需要将演奏的音符的音名和对应的节拍标记出来就可以，中间用/间隔，多个音符间用任意多个空格间隔；如果是同时演奏多个音符，那么每一组音符/节拍之间用|间隔。**注意这里用到的各种符号以及小节序号都是使用英文半角符号标记的**。<br /><br />
再举个例子吧，`&/2.0 C5/0.5`表示先休止2拍，再演奏C5这个音符0.5拍，`&`表示休止符，除了休止符，mus中再无其他特殊符号了。如果在乐谱中遇到了三连音这种特殊情况的话，那就麻烦你稍微计算一下啦，例如三个音符的演奏时长为0.5拍，那么每个音符的演奏时长约为0.167拍，你就可以这样标记`C5/0.167 D5/0.167 E5/0.167`。<br /><br />
在项目的public/music目录下，有**summer**和**江南**两个已经编写好的mus文件，可以查看其格式，点击操作面板中的打开按钮，读取文件进行自动演奏。<br /><br />
相信你现在已经可以顺利地将乐谱翻译成mus文件了:blush:，不过这样手动编写mus文件着实有些繁琐，也很容易出错，在Magical Piano的后续版本中会增加曲谱编辑器功能来辅助翻译乐谱，并自动生成mus文件。
## 未来的版本
Magical Piano目前支持解析mus文件自动演奏，手动演奏与升降调等基本功能，在未来的版本中我将继续开发如下功能：
* 音符雨
* 解析并播放midi文件
* mus曲谱编辑器
* 外接midi键盘演奏
## 最后
<font color="#0080FF">本项目仅用于学习和娱乐，如需转载请注明出处。</font>
<br />
如果你发现项目中存在bug或有其他的意见和建议，欢迎在issue中留言。
<br/>
如果你觉得我的项目很赞，记得多多**fork**与**star**哦！